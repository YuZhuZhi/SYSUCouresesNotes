# 离散数学(四)——关系

## 一、关系的基本概念

### 1.有序对与笛卡尔积

以往我们总是见到“一个点处在平面$R\times R$上”之类的表述，粗略地理解为一个由两个垂直的实数轴张成的平面。**笛卡尔积**实际是生成一个以**有序对**作为元素的集合，放到平面几何中来说，上述的粗略理解倒也正确。

所谓的**有序对**，由两个元素$a,b$构成，记成$\langle a,b\rangle$。既然它被称作“有序对”，那么就与集合的无序不同，尖括号内的元素按不同的顺序构成、那么生成的有序对亦不同。准确地说：

$$a\neq b\leftrightarrow\langle a,b\rangle\neq\langle b,a\rangle$$

>实际上有序对也可以用圆括号来书写，比如$(a,b)$，这就是我们通常见到的“坐标”的形式。

而两个集合$A,B$间的笛卡尔积记成$A\times B$，定义为：

$$A\times B=\{\langle a,b\rangle|a\in A\land b\in B\}$$

显然在大多数情况下$A\times B\neq B\times A$。笛卡尔积既不满足**交换律**也不满足**结合律**。但是，笛卡尔积**与集合并有分配律**：

$$A\times(B\cup C)=(A\times B)\cup(A\times C)$$

$$(B\cup C)\times A=(B\times A)\cup(C\times A)$$

## 2.关系

一个**关系**我们通常用大写字母$R$来表示，它亦是一种**集合**，取的是两个集合的笛卡尔积的**子集**，即$R\subseteq A\times B$。如果$A=B$，那么我们称$R$是集合$A$上的关系。

对于$A\times B$中的元素$\langle a,b\rangle$，如果它是$R$中的元素，那么就称$a$和$b$**具有关系**$R$，可以记为$a\ R\ b$。可以结合比较常见的关系——比如实数域上的相等$=$——来理解。而从“相等”这个概念出发，我们引申出**恒等关系**，这种关系只存在于一个集合$A$及其自身的笛卡尔积$A\times A$中，记作$\Delta_A$：

$$\Delta_A=\{\langle a,a\rangle|a\in A\}$$

关系除了可以用集合的表示方法来表示之外，在元素较少的情况下也可以用**有向图**来表示。例如，有序对$\langle 3,4\rangle$在图中表示为顶点$3$指向顶点$4$的一条**有向边**。当然我们也能用更加“数学化”的**关系矩阵**来描述。假设集合$A=\{a_1,a_2,...,a_n\},B=\{b_1,b_2,...,b_k\}$，而它们有一个关系$R\subseteq A\times B$，由此唯一确定一个$n\times k$的布尔矩阵$\bm{M}_R$。记这个矩阵第$i$行$j$列的元素为$m_{ij}$，那么若$a_i$与$b_j$具有关系$R$，则$m_{ij}=1$，否则$m_{ij}=0$。

例如，恒等关系只是一个集合上的关系，因此恒等关系的关系矩阵必然是一个方阵；而恒等关系中都是自己对自己的关系，因此恒等关系矩阵的对角线上都是$1$、其余都为$0$，也即是一个**单位矩阵**。

---

## 二、关系的基本运算

### 1.逆关系

所谓的**逆关系**，就是将关系$R$中的每一个元素$\langle a,b\rangle$都替换为$\langle b,a\rangle$，记为$R^{-1}$，即：

$$R^{-1}=\{\langle b,a\rangle|\langle a,b\rangle\in R\}$$

显然，对一个关系逆运算两次可以回到自身，即$(R^{-1})^{-1}=R$。

并且，**逆运算保持子集关系**，即假设关系$R,S\subseteq A\times B$，若$R\subseteq S$，则$R^{-1}\subseteq S^{-1}$。

另外，逆运算**与集合的交或并是可交换的**：

$$(R\cup S)^{-1}=R^{-1}\cup S^{-1}$$

$$(R\cap S)^{-1}=R^{-1}\cap S^{-1}$$

>所谓可交换性，是指两种运算间，不论先做哪种运算，最后得到的结果都相同。

### 2.复合

假设两个关系$R\subseteq A\times B,S\subseteq B\times C$，显然我们能通过$R,S$得到一个新的关系使其是$A$到$C$的关系、剔除掉中间的集合$B$。称这种运算为**复合**，记为$S\circ R$：

$$S\circ R=\{\langle a,c\rangle\ |\ \exists b\in B(\langle a,b\rangle\in R\ \land\  \langle b,c\rangle\in S)\}$$

>按照常规的思维来说，既然是取$R$的第一个元素、$S$的第二个元素，应该记作$R\circ S$才对。因此请注意这里关系复合的记法与常规思维的不同。

关系复合**不满足交换律**，但**满足结合律**，即$T\circ(S\circ R)=(T\circ S)\circ R$。

关系复合还**保持子集关系**。假设有四个关系$R,S,U,W$，且$R\subseteq S,U\subseteq W$，那么$U\circ R\subseteq W\circ S$。

同时，如果$R\subseteq A\times B$，那么$\Delta_B\circ R=R=R\circ \Delta_A$。另外：

$$(S\circ R)^{-1}=R^{-1}\circ S^{-1}$$

$$\begin{cases}
    T\circ(R\cup S)=(T\circ R)\cup(T\circ S)\\
    (R\cup S)\circ T=(R\circ T)\cup(S\circ T)\\
\end{cases}$$

$$\begin{cases}
    T\circ(R\cap S)\subseteq T\circ R\\
    T\circ(R\cap S)\subseteq T\circ S\\
    (R\cap S)\circ T\subseteq R\circ T\\
    (R\cap S)\circ T\subseteq S\circ T\\
\end{cases}\qquad\Longrightarrow$$

$$\Longrightarrow\begin{cases}
    T\circ(R\cap S)\subseteq(T\circ R)\cap(T\circ S)\\
    (R\cap S)\circ T\subseteq(R\circ T)\cap(S\circ T)\\
\end{cases}$$

### 3.用关系矩阵表示关系的运算

假设有两个关系$R,S$，分别对应关系矩阵$\bm{M}_R,\bm{M}_S$，这两个矩阵中的元素分别记为$r_{ij},s_{ij}$。

(1)$R\cup S$

只需将两个关系矩阵做**逻辑或**运算即可，即$\bm{M}_{R\cup S}=\bm{M}_R\lor\bm{M}_S=[r_{ij}\lor s_{ij}]$，即将两个矩阵对应位置的元素作或运算即可。

(2)$R\cap S$

只需将两个关系矩阵做**逻辑与**运算即可，即$\bm{M}_{R\cap S}=\bm{M}_R\land\bm{M}_S=[r_{ij}\land s_{ij}]$，即将两个矩阵对应位置的元素作与运算即可。

(3)$R-S$

$R-S$的关系矩阵使用**特殊的减法**运算：$\bm{M}_{R-S}=\bm{M}_R\ominus\bm{M}_S=[r_{ij}\ominus s_{ij}]$，这个减法定义为只有$1$减去$0$才等于$1$。即：

$$0\ominus1=0\ominus1=1\ominus1=0\quad,\quad1\ominus0=1$$

(4)$R^{-1}$

逆关系的关系矩阵就是原关系矩阵的**转置**，即$\bm{M}_{R^{-1}}=\bm{M}_R^T=[r_{ji}]$。

(5)$S\circ R$

关系复合是将两个矩阵作**逻辑积**运算：$\bm{M}_{S\circ R}=\bm{M}_R\odot\bm{M}_S$。所谓矩阵逻辑积，实际就是普通的矩阵乘法，但是将数乘换做逻辑与、加和换做逻辑或。

---

## 三、关系的性质

接下来我们总假设关系$R$是**一个集合**$A$上的关系，即$R\subseteq A\times A$。

### 1.自反性

如果对于任意$a\in A$，都存在$\langle a,a\rangle\in R$，那么就说$R$是**自反的**。反之，如果都不存在$\langle a,a\rangle\in R$，则说是**反自反的**。

我们发现上述定义是针对$A$中的**全体元素**说的，因此自反性和反自反性都是非常严格的定义。一个关系是自反的那么必不反自反，如果反自反则必不自反，也就是自反性和反自反性是**互斥的**(除非$A$是空集！)。但是由于这两种性质非常严格，一个关系可以**既不自反也不反自反**。

实数域上常见的自反关系显然有相等，以及带有“相等”的大于等于、小于等于，这些符号两边的数字相等则式子为真；常见的反自反关系有大于和小于，符号两边的数字相等则式子不成立。

显然，自反与反自反与*恒等关系*间存在联系。若一个关系是*自反的*，那么恒等关系必是它的**子集**，即$\Delta_A\subseteq R$；如果一个关系是*反自反的*，那么恒等关系与这个关系**没有交集**，即$\Delta_A\cap R=\varnothing$。

当我们用关系矩阵来表示这个关系的时候，如果其对角线上都是$1$，那么这是一个自反关系；如果都是$0$，则是一个反自反关系。否则既不自反也不反自反。

### 2.对称性

现在讨论全体的$\langle a,b\rangle\in R$。如果$\langle b,a\rangle$也属于$R$，那么称$R$是**对称的**；而在$a\neq b$的情况下，如果$\langle b,a\rangle$都属于$R$，那么称$R$是**反对称的**。

>更加公理化的定义是：
>$$R是对称的\quad当且仅当\quad\forall a\in A\forall b\in A(\langle a,b\rangle\in R\rightarrow\langle b,a\rangle\in R)$$
>$$R是反对称的\quad当且仅当\quad\forall a\in A\forall b\in A(\langle a,b\rangle\in R\land\langle b,a\rangle\in R\rightarrow a=b)$$

当然从关系矩阵的角度来看对称性和反对称性更加直观。对于对称性，上述定义要求*对称关系*的关系矩阵是一个**对称矩阵**，即关于对角线对称，即转置矩阵与原矩阵相等$\bm{M}_R=\bm{M}_R^T$；而对于*反对称性*，则是要求非对角线上两个对称的元素$r_{ij}$和$r_{ji}$都**不能同时为**$1$。注意到$a\neq b$，这是让我们不用关心对角线元素，也就是说自反性不影响反对称性。

从集合的角度而言，如果$R=R^{-1}$则关系是*对称的*，这对应上述的转置矩阵与原矩阵相等；而如果关系与其逆关系的交集是**恒等关系的子集**，即$R\cap R^{-1}\subseteq\Delta_A$，即可判定它是*反对称的*。

对称性和反对称性也是非常严格的，两者**互斥**(除非$A$是空集！)，但是一个关系可以**既不对称也不反对称**。实数域上的典型对称关系是相等和不相等，而其他的大于、大于等于等都是反对称关系。

### 3.传递性

**传递性**比较类似于关系与其自身的*复合*。如果对于任意$\langle a,b\rangle,\langle b,c\rangle\in R$，都有$\langle a,c\rangle\in R$，那么称关系$R$是传递的。

>更加公理化的定义是：
>$$R是传递的\quad当且仅当\quad\forall a\in A\forall b\in A\forall c\in A(\langle a,b\rangle\in R\land\langle b,c\rangle\in R\rightarrow\langle a,c\rangle\in R)$$

关系矩阵不能直观反映关系是否具有传递性。为了更简单地判定关系的传递性，我们通常计算关系与其自身的复合$R\circ R$。如果$R\circ R\subseteq R$，那么关系就是*传递的*；否则不是传递的。

实数域上的大部分关系都是传递的，比如相等、大于(等于)等。

### 4.关系性质的性质概括法定义

上述中，从集合角度来考察关系性质的，就是**性质概括法**，可以利用之来验证关系性质。现总结罗列如下：

(1)$R$**具有自反性**：$\Delta_A\subseteq R$

(1)$R$**具有反自反性**：$\Delta_A\cap R=\varnothing$

(1)$R$**具有对称性**：$R=R^{-1}$

(1)$R$**具有反对称性**：$R\cap R^{-1}\subseteq\Delta_A$

(1)$R$**具有传递性**：$R\circ R\subseteq R$

### 5.关系运算与关系性质

首先给出下表：

$$\begin{matrix}
    & 运算 & 自反性 & 反自反性 & 对称性 & 反对称性 & 传递性\\
    & R^{-1} & \checkmark & \checkmark & \checkmark & \checkmark & \checkmark\\
    & R\cap S & \checkmark & \checkmark & \checkmark & \checkmark & \checkmark\\
    & R\cup S & \checkmark & \checkmark & \checkmark & \times & \times\\
    & R-S & \times & \checkmark & \checkmark & \checkmark & \times\\
    & R\circ S & \checkmark & \times & \times & \times & \times\\
\end{matrix}$$

现在解释上表的含义。这张表描述的是，如果给出的两个(或一个)关系**都**具有某种性质的话，那么运算结果是否还有这种性质。比如，如果$R,S$都对称，那么$R\cup S$也对称；如果$R,S$都自反，那么$R-S$不一定自反。

---

## 四、关系的闭包

还是假定关系$R$是**一个集合**$A$上的关系，即$R\subseteq A\times A$。这个关系可能不自反、或者不对称、或者不传递，但我们可以通过一些手段**扩展**这个关系(也就是添加一些有序对元素)、并且只添加**最少量**的元素，使之成为一个自反或对称或传递的关系。这个新生成的关系称为**闭包**。

### 1.自反闭包

正如上述，**自反闭包**是在原关系的基础上，以最小的扩展生成**自反关系**。$R$的自反闭包记为$r(R)$，这是取$reflexive$的首字母。由于只要恒等关系是关系的子集那么关系就是自反的，因此$r(R)=R\cup\Delta_A$。

>现在给出自反闭包$r(R)$的定义：
>其一，自反闭包是原关系的扩展，即原关系是自反闭包的子集：$R\subseteq r(R)$；
>其二，自反闭包是自反关系：$\Delta_A\subseteq r(R)$；
>其三，对于任意包含原关系的自反关系$S$，自反闭包亦是它的子集：$R\subseteq S\rightarrow r(R)\subseteq S$。

自反闭包可以证明一个关系是自反的，只要一个关系的**自反闭包等于它自己**。也就是若$r(R)=R$则$R$自反，反之亦然。

自反闭包**保持子集关系**，即若$R\subseteq S$，那么$r(R)\subseteq r(S)$。

自反闭包**与集合的交与并是可交换的**，即：

$$r(R\cap S)=r(R)\cap r(S)$$

$$r(R\cup S)=r(R)\cup r(S)$$

### 2.对称闭包

$R$的**对称闭包**记为$s(R)$，这是取$symmetric$的首字母。为了以最小的扩展生成对称关系，只需要将关系遍历一遍，添加原本没有的对称有序对即可，即$s(R)=R\cup R^{-1}$。

>现在给出对称闭包$s(R)$的定义：
>其一，对称闭包是原关系的扩展，即原关系是对称闭包的子集：$R\subseteq s(R)$；
>其二，对称闭包是对称关系：$s(R)=(s(R))^{-1}$；
>其三，对于任意包含原关系的对称关系$S$，对称闭包亦是它的子集：$R\subseteq S\rightarrow s(R)\subseteq S$。

对称闭包可以证明一个关系是对称的，只要一个关系的**对称闭包等于它自己**。也就是若$s(R)=R$则$R$对称，反之亦然。

对称闭包**保持子集关系**，即若$R\subseteq S$，那么$s(R)\subseteq s(S)$。

自反闭包**与集合并是可交换的**，但**与集合交不是**，即：

$$s(R\cap S)\subseteq s(R)\cap s(S)$$

$$s(R\cup S)=s(R)\cup s(S)$$

### 3.传递闭包

$R$的**传递闭包**记为$t(R)$，这是取$transitive$的首字母。

>现在给出传递闭包$t(R)$的定义：
>其一，传递闭包是原关系的扩展，即原关系是传递闭包的子集：$R\subseteq t(R)$；
>其二，传递闭包是传递关系：$t(R)\circ t(R)\subseteq t(R)$；
>其三，对于任意包含原关系的传递关系$S$，传递闭包亦是它的子集：$R\subseteq S\rightarrow t(R)\subseteq S$。

传递闭包可以证明一个关系是传递的，只要一个关系的**传递闭包等于它自己**。也就是若$t(R)=R$则$R$传递，反之亦然。

传递闭包**保持子集关系**，即若$R\subseteq S$，那么$t(R)\subseteq t(S)$。

传递闭包与集合的交并**只有子集的关系**：

$$t(R\cap S)\subseteq t(R)\cap t(S)$$

$$t(R)\cup t(S)\subseteq t(R\cup S)$$

注意到到这里为止我们还没讲如何从原关系生成传递闭包。为此，我们需要先引入**关系的幂**。关系的$n$次幂，记作$R^n$，是关系与自己的$n$次复合。例如，$R^3=R\circ R\circ R$。

从关系矩阵的角度来说，取$R^n$的关系矩阵中的某一个元素$m_{ij}$。若$m_{ij}=1$，那么这说明元素$i$到$j$之间具有一条**长度为$n$的通路**。例如，原关系的关系矩阵就是在描述哪些元素间具有**直接通路**，也就是长度为$1$的通路。

在一个传递的关系中，若两个元素间具有一条长度大于等于$2$的通路，那么这两个元素间就应当有一条直接通路。因此，我们每计算一次$R^n$，就是在寻找任意两个元素间的$n$通路，当我们从$1$遍历到正无穷的时候，就相当于找到了所有长度的通路。这样，只要在“有通路”的两个元素间建立一条直接通路，我们就生成了原关系的*传递闭包*：

$$t(R)=\displaystyle\bigcup_{n=1}^{+\infty}R^n=R^*$$

$R^*$是中间的关系广义并的简记。然而实际上我们不可能一直计算到无穷大。假设$A$中有$n$个元素。如果一条通路长度大于$n$、那么这条通路必然会经过**重复的顶点**(鸽笼原理)，因此这条通路已经是至少两条长度小于$n$的通路的相连了。也就是说，我们只需计算到$R^n$即可结束：

$$t(R)=\displaystyle\bigcup_{k=1}^{n}R^k$$

### 4.Warshall算法

Warshall算法实际就是图论中的Floyd算法。这个算法是利用递推式，从$\bm{W}_0=\bm{M}_R$开始，计算到$\bm{W}_n$为止。$\bm{W}_n$本身就是传递闭包结果，这省略了求广义并的过程。

记$w_{ij}^k$为矩阵$\bm{W}_k$的第$i$行$j$列元素。第$k$个矩阵由上一个矩阵，也就是第$k-1$个矩阵完全确定。递推式是：

$$w_{ij}^k=w_{ij}^{k-1}\lor(w_{ik}^{k-1}\land w_{kj}^{k-1})$$

---

## 五、等价关系

**等价关系**是一个非常严格的关系。如果一个关系同时是**自反关系、对称关系、传递关系**，那么称它为等价关系。实数域上的典型等价关系就是相等。

接下来假定等价关系$R\subseteq A\times A$。

### 1.等价类

**等价类**是一个**集合**，它的元素来源于集合$A$，也就是说它的元素不是有序对。等价类必须基于集合$A$中的某个元素，例如$a$，将所有与$a$等价的元素囊括进来，就形成了$a$(所在等价关系上)的等价类，记为$[a]_R$。也就是：

$$[a]_R=\{x\in A|\langle a,x\rangle\in R\}$$

由于**自反性**，等价类中必然至少有一个元素，因此等价类**不可能是空集**：

$$[a]_R\neq \varnothing$$

### 2.代表

既然等价类内的任意一个元素都是等价的，那么取任一个元素它都能“代表”这个等价类。也就是说，只要$b\in [a]_R$，那么$b$就是这个等价类的一个**代表**。当然$a$本身也是这个等价类的代表。

任取集合$A$中的两个元素$a,b$，它们之间要么等价要么不等价，因此它们代表的等价类**要么相等要么没有交集**，也就是：

$$[a]_R=[b]_R\quad或\quad [a]_R\cap[b]_R=\varnothing$$

必居其中之一。

### 3.商集

**商集**是一个**集合族**，它是以等价类作为划分依据的等价关系的**划分**。

>复习：将一个集合$A$划分为几个互不相交的部分，每个部分自成一个集合，那么这些集合就可以形成一个集合族，称为$A$的**划分**，记为$\mathcal{F}$。划分中的每一个集合称为一个**划分块**。

也就是每一个*等价类*都是一个**划分块**。$A$中所有元素的等价类构成的集合族，称为集合$A$关于等价关系$R$的**商集**，记为$A/R$：

$$A/R=\{[a]_R\ |\ a\in A\}$$

商集作为集合$A$的划分，显然其广义并就是集合$A$：

$$\displaystyle\bigcup_{a\in A}[a]_R=\bigcup A/R=A$$

---

## 六、偏序关系

如果一个关系**自反、反对称、传递**，那么称它为**偏序关系**，也简称为**偏序**，此时我们可以用一个类似小于等于的符号$\preceq$来表示它。

在此基础上，如果它是**反自反的**，那么称之为**严格序**关系。事实上，如果一个关系**既反自反又传递**，那么它必是一个**反对称关系**。

如果一个关系**自反且传递、但不反对称**，那么称它为**拟序**关系。

接下来我们着重于偏序关系$R\subseteq A\times A$，或者写成$\preceq\subseteq A\times A$：

### 1.偏序集与比较

**偏序集**需要包含偏序关系、以及偏序关系所处在的集合，记为$(A,\preceq)$。注意到**反对称性**只要求两个元素$a,b$的有序对$\langle a,b\rangle,\langle b,a\rangle$不同时存在，也即允许两者**都不存在**，此时既不存在$a\preceq b$也不存在$b\preceq a$，则称$a,b$间**不可比**。反之，称为**可比的**。当$A$中任意两个元素**都**可比，那么称偏序集$(A,\preceq)$是**全序**的，或称为**线序**的。

>需要注意在偏序关系中，$a\neq b$不代表$a\preceq b$且$a\succeq b$，因为偏序关系是**反对称的**！$a\neq b$仅仅是强调“$a$和$b$不是同一个元素”。

假如$a,b$间有$a\prec b$，并且中间**不存在**一个元素$c$使得$a\prec c$且$c\prec b$，则称$b$**覆盖**$a$。

### 2.哈斯图

**哈斯图**是一种简化的关系图，用于表示一个偏序关系。

由于偏序关系是**对称的**，每个元素必有一条指回自己的**环**，这显然可以省略；

由于偏序关系是**传递的**，两元素间有长度大于等于$2$的通路则必有直接通路，因此略去所有长度大于等于$2$的通路。这意味着只有一个元素**覆盖**另一个元素时，两者间才有边；

规定偏序关系中较大者总画在较小者的上方，这样可以略去方向。

### 3.元与确界

首先我们来讲讲**极大元、极小元、最大元、最小元**：

取$A$中的某一个元素$a$。如果在$A$中没有比$a$更大的元素，那么称$a$为**极大元**；反之，如果在$A$中没有比$a$更小的元素，那么称$a$为**极小元**。

如果$a$大于等于$A$中**所有**的元素，那么称$a$为**最大元**；反之，如果$a$小于等于$A$中**所有**的元素，那么称$a$为**最小元**。

>上面这两段话乍一看没啥区别，但关键在于是否是对“**所有**”的元素！如果存在与$a$不可比的元素，那么$a$就不能是最大元或最小元。

因此，如果$a$是**最大元**，那么它亦必是**极大元**；如果$a$是**最小元**，那么它亦必是**极小元**。(只有)在偏序集是**全序**的情况下，如果$a$是**极大元**，那么它亦是**最大元**；如果$a$是**极小元**，那么它亦是**最小元**。

再者，偏序集可以既没有最大元、也没有最小元，但如果有最大元、则最大元必**唯一**，如果有最小元、则最小元必**唯一**。然而，极大元和极小元的数量可以**不限**，既可以没有，也可以有多个。

接下来我们讲讲**上界、下界、上确界、下确界**：

“界”是针对偏序集$(A,\preceq)$的**子集**来说的。从偏序集中取一子集$S$，如果$A$中存在一个元素$a$大于等于$S$中的**所有**元素(注意是所有！)，则称$a$是$S$的**上界**；反之，若元素$a$小于等于$S$中的**所有**元素，则称$a$是$S$的**下界**。注意，这里只要求$a\in A$，也就是$S$中的元素也可以是$S$的上界或下界。

而**上界中的最小元**称为$S$的**上确界**，**下界中的最大元**称为$S$的**下确界**。类似于最大元最小元，$S$可以既没有上确界也没有下确界，但如果有的话必**唯一**；上确界必是上界，下确界也必是下界。

并且，如果有上界属于$S$，那么它必是上确界；同理，如果有下界属于$S$，那么它必是下确界。
